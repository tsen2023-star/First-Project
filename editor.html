
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Editor - CodeCompiler</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>

    <style>
        /* Home Button Style */
        #home-btn {
            background: linear-gradient(45deg, #621b91, #232f96);
            color: white;
            font-size: 16px;
            font-weight: bold;
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        #home-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgb(225, 12, 12);
        }

        /* NEW: Download Button Style */
        #download-btn {
            background: linear-gradient(45deg, #8f28b8, #0072ff);
            color: white;
            font-size: 15px;
            font-weight: bold;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-left: 10px;
        }
        #download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 10px rgb(216, 49, 49);
        }

        /* Clear Button Header Styles */
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 15px;
            background: #1e1e1e;
            border-bottom: 1px solid #333;
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #804ea1, #a70da1);
            color: #ccc;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .clear-btn:hover {
            background: #be0e0e;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo"><span>&lt;/&gt;</span> Code Compiler</div>
        <div class="header-actions">
            <button id="home-btn" onclick="window.location.href='index.html'">← Home</button>
        </div>
    </div>

    <div class="language-tabs">
        <button class="lang-tab" data-lang="python" onclick="switchLanguage('python')">Python</button>
        <button class="lang-tab" data-lang="cpp" onclick="switchLanguage('cpp')">C++</button>
        <button class="lang-tab" data-lang="java" onclick="switchLanguage('java')">Java</button>
        <button class="lang-tab" data-lang="c" onclick="switchLanguage('c')">C</button>
        <button class="lang-tab" data-lang="html" onclick="switchLanguage('html')">HTML</button>
        <button class="lang-tab" data-lang="css" onclick="switchLanguage('css')">CSS</button>
    </div>

    <div class="main-container">
        <div class="editor-section">
            <div class="toolbar">
                <button class="run-btn" onclick="submitCode()">▶ Run</button>
                <button id="download-btn" onclick="downloadCode()">⬇ Download</button>
            </div>
            <textarea id="code-editor" spellcheck="false" placeholder="Write your code here..."></textarea>
        </div>

        <div class="output-section">
            <div class="output-header">
                <span class="output-title">Interactive Terminal Output</span>
                <button class="clear-btn" onclick="clearOutput()">Clear</button>
            </div>
            <div id="terminal-container" style="height: 100%; width: 100%; padding: 10px; background: #2b2b2b;"></div>
        </div>
    </div>

    <script>
        var currentLang = 'python';
        var starterCode = {
            python: 'name = input("Enter your name: ")\nprint("Hello, " + name + "!")',
            cpp: '#include <iostream>\nusing namespace std;\n\nint main() {\n    string name;\n    cout << "Enter your name: ";\n    cin >> name;\n    cout << "Hello, " << name << "!" << endl;\n    return 0;\n}',
            java: 'import java.util.Scanner;\n\npublic class Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        System.out.print("Enter your name: ");\n        String name = sc.nextLine();\n        System.out.println("Hello, " + name + "!");\n    }\n}',
            c: '#include <stdio.h>\n\nint main() {\n    char name[50];\n    printf("Enter your name: ");\n    scanf("%s", name);\n    printf("Hello, %s!\\n", name);\n    return 0;\n}',
            html: '<h1>My Website</h1>\n<p>Rendered in browser.</p>',
            css: 'body { background-color: #222; color: white; }'
        };

        var term = new Terminal({
            theme: { background: '#000000' },
            cursorBlink: true,
            fontSize: 14,
            fontFamily: 'Consolas, "Courier New", monospace'
        });
        var fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        term.open(document.getElementById('terminal-container'));
        fitAddon.fit();
        term.write('Terminal ready. Write code and click Run...\r\n');

        var ws = null;
        var inputBuffer = '';

        function clearOutput() {
            term.clear();
            term.write('\x1bc'); 
            term.write('Terminal cleared.\r\n');
        }

        term.onData(data => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                if (data === '\r') {
                    term.write('\r\n');
                    ws.send(inputBuffer + '\n');
                    inputBuffer = '';
                } else if (data === '\u007f') {
                    if (inputBuffer.length > 0) {
                        inputBuffer = inputBuffer.slice(0, -1);
                        term.write('\b \b');
                    }
                } else {
                    inputBuffer += data;
                    term.write(data);
                }
            }
        });

        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('selectedLanguage', lang);
            document.querySelectorAll('.lang-tab').forEach(t => t.classList.toggle('active', t.dataset.lang === lang));
            document.getElementById('code-editor').value = starterCode[lang];
        }

        function submitCode() {
            const code = document.getElementById('code-editor').value;

            if (currentLang === 'html' || currentLang === 'css') {
                let preview = window.open("", "Preview", "width=800,height=600");
                preview.document.open();
                preview.document.write(currentLang === 'html' ? code : `<style>${code}</style><h1>Styles Applied</h1>`);
                preview.document.close();
                
                term.clear();
                term.write('\x1bc');
                term.write('Preview opened in a new window.\r\n');
                return;
            }

            term.clear();
            term.write('\x1bc'); 
            term.write('Connecting to server...\r\n');
            inputBuffer = '';

            if (ws) { ws.close(); }
// Replace 'your-backend-app.onrender.com' with the actual URL provided by your hosting service
ws = new WebSocket("wss://your-backend-app.onrender.com/ws/run");

            ws.onopen = () => {
                ws.send(JSON.stringify({ language: currentLang, code: code }));
            };

            ws.onmessage = (event) => {
                term.write(event.data);
            };

            ws.onerror = () => {
                term.write('\r\nConnection error. Is the backend running?\r\n');
            };
        }

        function downloadCode() {
            const ext = {python:'py', cpp:'cpp', java:'java', c:'c', html:'html', css:'css'}[currentLang];
            const blob = new Blob([document.getElementById('code-editor').value], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `code.${ext}`;
            a.click();
        }

        window.addEventListener('resize', () => { fitAddon.fit(); });
        window.onload = () => switchLanguage(localStorage.getItem('selectedLanguage') || 'python');
    </script>
</body>
</html>

